<!DOCTYPE html>
<html lang="en">

<head>
    <title>Chefs 4 Me</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link type="text/css" rel="stylesheet" href="/css/bootstrap.css" />
    <link type="text/css" rel="stylesheet" href="/css/main.css" />
    <script src="/js/jquery.js" type="text/javascript" ></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/ie10-viewport-bug-workaround.js"></script>
    <script src="/js/jquery.validate.js"></script>
    <style>
        body {padding-top: 75px}
        .thumbnail {padding: 25px}
    </style>
</head>

<body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Chefs 4 Me</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/chefs">Local Chefs</a>
                    </li>
                    <li>
                        <a href="/inbox">Inbox</a>
                    </li>
                    <li>
                        <a href="/preview">My Menu</a>
                    </li>
                    <li class="dropdown active">
                        <a href="/preview" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Profile<span class="caret"></span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="/profile">Profile</a></li>
                            <li><a href="/payment">Payment</a></li>
                            <li><a href="/security">Account</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="/logout">LogOut</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container" id="wrap">
        <div class="row">
            <div class="col-md-3">
                <div class="text-center">
                    <img class="img-circle col-md-12 col-xs-12" src="{{photo}}" alt="Profile Picture">
                </div>
                <p class="text-center"><strong>Account Settings</strong></p>
            </div>
            <div class="col-md-9">
                <div class="thumbnail">
                    <form id=update_email class="box" method=post>
                        <h3>Update Email</h3><hr>
                        <p class="text-danger">{{message}}</p>
                        <div class="col-md-3">
                            <strong>New Email Address</strong>
                        </div>
                        <div class="col-md-9">
                            <div class="form-group has-feedback">
                                <div class="input-group" id="email2">
                                    <span class="input-group-addon">@</span>
                                    <input type="text" class="form-control" id="email" name="email" value="{{email}}">
                                    <span class="glyphicon form-control-feedback" id="email1"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <strong>Confirm New Email</strong>
                        </div>
                        <div class="col-md-9">
                            <div class="form-group has-feedback">
                                <div class="input-group" id="confirm2">
                                    <span class="input-group-addon">@</span>
                                    <input type="text" class="form-control" id="confirm" name="confirm">
                                    <span class="glyphicon form-control-feedback" id="confirm1"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                        <p class="text-center">
                            <input class="btn btn-md btn-primary" type="submit" name="update_email" value="Update Email">
                        </p>
                    </form>
                </div>
                <div class="thumbnail">
                    <form id="change_password" class="box" method=post>
                        <h3>Change Password</h3><hr>
                        <p class="text-danger">{{pw_message}}</h4><p>
                        <div class="row">
                            <div class="col-md-3">
                                <strong>Old Password</strong>
                            </div>
                            <div class="col-md-9">
                                <div class="form-group has-feedback">
                                    <div class="input-group" id="old2">
                                        <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                        <input type="password" class="form-control" id="old" name="old" placeholder="Old Password">
                                        <span class="glyphicon form-control-feedback" id="old1"></span>
                                    </div>
                                </div>                
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <strong>New Password</strong>
                            </div>
                            <div class="col-md-9">
                                <div class="form-group has-feedback">
                                    <div class="input-group" id="password2">
                                        <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                        <input type="password" class="form-control" id="password" name="password" placeholder="New Password">
                                        <span class="glyphicon form-control-feedback" id="password1"></span>
                                    </div>
                                </div>                
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <strong>Re-enter New Password</strong>
                            </div>
                            <div class="col-md-9">
                                <div class="form-group has-feedback">
                                    <div class="input-group" id="verify2">
                                        <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                        <input type="password" class="form-control" id="verify" name="verify" placeholder="Re-enter New Password">
                                        <span class="glyphicon form-control-feedback" id="verify1"></span>
                                    </div>
                                </div>                
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                        <p class="text-center">
                            <input class="btn btn-md btn-primary" type="submit" name="change_password" value="Change Password">
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="footer">
        <div class="container">
            <p>© 2015 4 Me Services · <a href="#">Terms</a></p>
        </div>
    </div>
    <script>
            $(function(){
                $('#email').on('input', function() {
					var input=$(this);
					var re = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
					var is_email=re.test(input.val());
					if(is_email){input.removeClass("invalid").addClass("valid");}
					else{input.removeClass("valid").addClass("invalid");}
				});
                $('#confirm').on('input', function() {
                    var input = $(this);
                    var new_email = $('#email').val();
                    if (input.val()==new_email) {input.removeClass("invalid").addClass("valid");}
                    else {input.removeClass("valid").addClass("invalid");}
                });
                $('#old').on('input', function() {
					var input=$(this);
                    var pw = /^(?=.*\d)(?=.*[a-z]).{6,20}$/;     
					var is_password=pw.test(input.val());
					if(is_password){input.removeClass("invalid").addClass("valid");}
					else{input.removeClass("valid").addClass("invalid");}
				});
                $('#password').on('input', function() {
					var input=$(this);
                    var pw = /^(?=.*\d)(?=.*[a-z]).{6,20}$/;     
					var is_password=pw.test(input.val());
					if(is_password){input.removeClass("invalid").addClass("valid");}
					else{input.removeClass("valid").addClass("invalid");}
				});
                $('#verify').on('input', function() {
					var input=$(this);
					var pwd = $('#password').val();
					if(input.val()==pwd){input.removeClass("invalid").addClass("valid");}
					else{input.removeClass("valid").addClass("invalid");}
				});
                $("#update_email").submit(function(){
				    var form_data=$('#update_email').serializeArray();
                    var error_free=true;
                    for (var input in form_data){
					   var element=$('#'+form_data[input]['name']);
					   var valid=element.hasClass("valid");
                       var error_element=$("span", element.parent());
					   if (!valid){error_element.removeClass("error").addClass("error_show"); error_free=false;}
					   else{error_element.removeClass("error_show").addClass("error");}
				    }
				    if (!error_free){
					   event.preventDefault(); 
				    }
				    else{
                        document.getElementById("#update_email").submit();
				    }
                });
                $("#change_password").submit(function(){
				    var form_data=$('#change_password').serializeArray();
                    var error_free=true;
                    for (var input in form_data){
					   var element=$('#'+form_data[input]['name']);
					   var valid=element.hasClass("valid");
                       var error_element=$("span", element.parent());
					   if (!valid){error_element.removeClass("error").addClass("error_show"); error_free=false;}
					   else{error_element.removeClass("error_show").addClass("error");}
				    }
				    if (!error_free){
					   event.preventDefault(); 
				    }
				    else{
                        document.getElementById("#change_password").submit();
				    }
                });
            });
        </script>
</body>